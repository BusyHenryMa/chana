=================================
Raspberry Pi 2 B Cluster Benchmark
=================================

Component
---------

+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| Item                   | Description                          | Dimensions (mm) | Unit Power (W) | Unit Price (￥) | Units | Price (￥) | Power (W) | Link                                                               |
+========================+======================================+=================+================+=================+=======+============+===========+====================================================================+
| Raspberry Pi 2 Model B | 单板机 Single Board Computer         | 85 x 56 x 17    |   3.0 | MyCase |          258.00 |    10 |   2,580.00 |      36.0 | http://cn.element14.com/raspberry-pi-accessories?ICID=ap-rpi-2-hwb |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| NETGEAR GS308          | 8 口千兆交换机 1Gbps Network Switch  | 158 x 102 x 26  |   3.8 | Max    |          299.00 |     2 |     598.00 |       7.6 | <http://item.jd.com/672092.html>                                   |   
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| ORICO DCP-4S-BK        | 4 口 USB 充电器 5V2.4Ax4 USB-charger | 96 x 57 x 21    |       |        |           79.00 |     3 |     237.00 |           | <http://item.jd.com/1208500.html>                                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| ORICO ADC-05-BK        | Micro USB 数据线 USB-cable           | 500L            |       |        |            9.90 |    10 |      99.00 |           | <http://item.jd.com/1183192.html>                                  | 
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| SanDisk 16G Class 10   | Micro SD Card                        |                 |       |        |           42.90 |    10 |     429.00 |           | <http://item.jd.com/679772.html>                                   |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| SAMZHE SZ-601BE        | CAT.6E 网线 Network Cable            | 1000L           |       |        |            7.90 |    12 |      98.80 |           | <http://item.jd.com/636308.html>                                   | 
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
|                                                                                                                                                                                                                          | 
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| e代家园 GRS11-35       | 配线箱 Case                          | 350 x 300 x 120 |       |        |          142.00 |     1 |     142.00 |           | <http://detail.tmall.com/item.htm?id=40266420582>                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| e代家园 IT-L           | 理线模块 Mounting Module             | 230 x 25        |       |        |           12.00 |     4 |      48.00 |           | <http://detail.tmall.com/item.htm?id=35189787138>                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| e代家园 GDC-P01        | 电源模块插座 Power Supply            | 165 x 49 x 36   |  40.0 | Output |           99.00 |     1 |      99.00 |      40.0 | <http://detail.tmall.com/item.htm?id=42224837564>                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| 单通铜螺柱 M2.5*5+6    |                                      |                 |       |        |            0.18 |    12 |       2.16 |           | <http://detail.tmall.com/item.htm?id=26930900577>                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| 单通铜螺柱 M2.5*25+6   |                                      |                 |       |        |            0.40 |    36 |      14.40 |           | <http://detail.tmall.com/item.htm?id=26930900577>                  |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
| 双通铜螺柱             |                                                                                                                                                                                                 | 
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+
|                        |                                      |                 |       |        |                 |       |   4,343.36 |                                                                                |
+------------------------+--------------------------------------+-----------------+-------+--------+-----------------+-------+------------+-----------+--------------------------------------------------------------------+

============================================
Akka 分片集群水平扩展能力分析
============================================

跟很多分片集群解决方案不同，akka 分片集群（sharding cluster）中每一个节点都在直接访问本地数据的同时，也都可以作为 proxy 访问集群中其它节点的数据。在我看来，这是 akka 分片集群水平扩展（scale-out）能力可能接近线性的关键。

在采用树莓派 2 组成的 10 个节点的集群中，我用 astore 测试了 akka 分片的水平扩展能力（见前面的几条相关微博），结果显示出非常好的线性。我们不妨在此做个简单的分析。

估算
^^^^^^^^^^


设 c 为连接数，\ :math:`\tau` 为平均响应时间，则单节点时 qps 为：

:math:`qps = c \left(\frac{1}{\tau}\right)`

当节点数为 n 时，数据有 \ :math:`\frac{1}{n}` 的概率在本节点，而 \ :math:`\frac{n-1}{n}` 的概率在其它节点。假设在本节点的平均响应时间仍然为 \ :math:`\tau_1`，在其它节点的则为 \ :math:`\tau_2`，则总体的平均响应时间为：

:math:`\tau=\frac{\tau_1 + (n-1)\tau_2}{n}`

这时，qps 为：

:math:`qps 
= cn \left(\frac{1}{\tau}\right)
= cn \left(\frac{1}{\frac{\tau_1 + (n-1)\tau_2}{n}}\right)
= cn \left(\frac{n}{\tau_1 + (n-1)\tau_2}\right)
= cn \left(\frac{n}{\tau_2n - (\tau_2-\tau_1)}\right)`

当 \ :math:`(\tau_2-\tau_1)` 随着 n 的增加而越来越小于 \ :math:`\tau_2n` 时，我们可以开始忽略 \ :math:`(\tau_2-\tau_1)` 项，也即：

:math:`qps 
\propto cn\left(\frac{n}{\tau_2n}\right)
\propto cn\left(\frac{1}{\tau_2}\right)
\propto n`

实测数据
^^^^^^^^^^

下面我们看看几个测试中实际的数据：

连接数 \ :math:`c=100`

单节点时，平均响应时间 \ :math:`\tau=0.06s`，则：

:math:`qps = 100 \left(\frac{1}{0.06}\right) = 1667`

多节点情况下，假设 \ :math:`\tau_1=0.06s` 不变，根据测试数据可以估算出 \ :math:`\tau_2=0.180s` 左右，则：

:math:`qps=100n \left(\frac{n}{0.18n - 0.12}\right)`

从这个公式可以看出，当 n 逐渐增大时，\ :math:`0.18n - 0.12` 中的 \ :math:`0.18n` 比重很快上升，当 n = 7 时，\ :math:`0.18n=1.26`，已经是 0.12 的 10 倍，

那么这个公式是否真的有效呢？我计算了 n 从 2 到 10 的数据，跟实测数据很接近：

+----+------+------+
|  n | 估算 | 实测 |
+====+======+======+
|  1 | 1667 | 1643 |
+----+------+------+
|  2 | 1667 | 1505 |
+----+------+------+
|  3 | 2143 | 2102 |
+----+------+------+
|  4 | 2667 | 2685 |
+----+------+------+
|  5 | 3205 | 3243 |
+----+------+------+
|  6 | 3750 | 3749 |
+----+------+------+
|  7 | 4298 | 4297 |
+----+------+------+
|  8 | 4848 | 4846 |
+----+------+------+
|  9 | 5400 | 5370 |
+----+------+------+
| 10 | 5952 | 5920 |
+----+------+------+

